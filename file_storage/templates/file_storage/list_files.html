{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <h1><a href="{% url 'file_storage:list_files' %}" class="text-dark text-decoration-none">Мои файлы</a></h1>
        <!-- Навигация - "хлебные крошки" -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                {% if breadcrumbs %}
                    {% for folder in breadcrumbs %}
                        {% if forloop.last %}
                            <li class="breadcrumb-item active">{{ folder.name }}</li>
                        {% else %}
                            <li class="breadcrumb-item"><a
                                    href="{% url 'file_storage:list_files' %}?folder={{ folder.id }}">{{ folder.name }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </ol>
        </nav>

        <!-- Кнопки действий -->
        <div class="mb-4">
            <a href="
                    {% url 'file_storage:upload_file' %}{% if current_folder %}?folder={{ current_folder.id }}{% endif %}"
               class="btn btn-primary">
                <i class="fas fa-upload"></i> Загрузить файл
            </a>
        {% comment %}
              <a href="{% url 'file_storage:create_directory' %}{% if current_folder %}?folder={{ current_folder.id }}{% endif %}"
               class="btn btn-secondary">
                <i class="fas fa-folder-plus"></i> Создать папку
            </a>
        {% endcomment %}
        </div>

        <!-- Список файлов и папок -->
        {% if objects %}
            <div class="row">
                {% for item in objects %}
                    <div class="col-md-3 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                {% if item.is_directory %}
                                    <h5 class="card-title">
                                        <i class="fas fa-folder"></i>
                                        <a href="{% url 'file_storage:list_files' %}?folder={{ item.id }}">{{ item.name }}</a>
                                    </h5>
                                    <p class="card-text">
                                        <small class="text-muted">Создана: {{ item.created_at|date:"d.m.Y H:i" }}</small>
                                    </p>
                                    <a href="{% url 'file_storage:delete_file' item.id %}"
                                       class="btn btn-sm btn-danger">
                                        <i class="fas fa-trash"></i> Удалить
                                    </a>
                                {% else %}
                                    <h5 class="card-title">
                                        <i class="fas fa-file"></i>
                                        {{ item.name }}
                                    </h5>
                                    <p class="card-text">
                                        <small class="text-muted">
                                            Размер: {{ item.file_size|filesizeformat }}<br>
                                            Загружен: {{ item.created_at|date:"d.m.Y H:i" }}
                                        </small>
                                    </p>
                                    <div class="btn-group">
                                        <a href="{{ item.file.url }}" class="btn btn-sm btn-primary">
                                            <i class="fas fa-download"></i> Скачать
                                        </a>
                                        {% comment %}
                                        <a href="{% url 'file_storage:delete_file' item.id %}"
                                           class="btn btn-sm btn-danger">
                                            <i class="fas fa-trash"></i> Удалить
                                        </a>
                                        {% endcomment %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                {% if current_folder %}
                    Эта папка пуста.
                {% else %}
                    У вас еще нет файлов.
                {% endif %}
                <a href="
                        {% url 'file_storage:upload_file' %}{% if current_folder %}?folder={{ current_folder.id }}{% endif %}">Загрузите
                    файл</a> или
            {% comment %}
                <a href="
                        {% url 'file_storage:create_directory' %}{% if current_folder %}?folder={{ current_folder.id }}{% endif %}">создайте
                    папку</a>.
            {% endcomment %}
            </div>
        {% endif %}
    </div>
{% endblock %}